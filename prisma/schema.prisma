// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider      = "prisma-client-js"
  // Azure Static Web Apps runners provide OpenSSL so we only ship the dynamic
  // binaries to avoid 404 errors when downloading the deprecated static target.
  binaryTargets = ["native", "darwin", "darwin-arm64", "debian-openssl-1.1.x", "debian-openssl-3.0.x", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ATLETA
  AGENTE
  CLUBE
  TORCEDOR
  IMPRENSA
  RESPONSAVEL
  ADMINISTRADOR
  SUPER
  MODERADOR
}

enum UserStatus {
  ACTIVE
  BLOCKED
}

enum VideoVisibilityStatus {
  PUBLIC
  BLOCKED
}

enum VideoBlockAppealStatus {
  PENDING
  APPROVED
  REJECTED
}

enum NotificationType {
  VIDEO_BLOCK
  VIDEO_APPEAL_UPDATE
  USER_BLOCK
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
  id               String     @id @default(cuid())
  name             String?
  email            String?    @unique
  passwordHash     String
  emailVerified    DateTime?
  image            String?
  accounts         Account[]
  sessions         Session[]
  videos           Video[]
  news             News[]
  profile          Profile?
  following        Follow[]   @relation("UserFollowing")
  followers        Follow[]   @relation("UserFollowers")
  blocking         Block[]    @relation("UserBlocking")
  blockedBy        Block[]    @relation("UserBlocked")
  sentMessages     Message[]  @relation("UserSentMessages")
  receivedMessages Message[]  @relation("UserReceivedMessages")
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt
  Game             Game[]
  newsLikes        NewsLike[]
  newsSaves        NewsSave[]
  gameLikes        GameLike[]
  gameSaves        GameSave[]
  status           UserStatus @default(ACTIVE)
  blockedReason    String?
  blockedAt        DateTime?
  blockedByAdminId String?
  lastWebLoginAt   DateTime?
  lastAppLoginAt   DateTime?
  administrativelyBlockedUsers User[] @relation("AdminBlockedUsers")
  blockedByAdmin               User?  @relation("AdminBlockedUsers", fields: [blockedByAdminId], references: [id])
  blockedVideos                Video[] @relation("VideoBlockedBy")
  notifications    Notification[]
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Profile {
  id                    String    @id @default(cuid())
  displayName           String?
  avatarUrl             String?
  bio                   String?
  role                  Role
  data                  Json?
  cpf                   String?
  rg                    String?
  cep                   String?
  nascimento            String?
  genero                String?
  telefone              String?
  ddd                   String?
  site                  String?
  endereco              String?
  redesSociais          String?
  areaAtuacao           String?
  portfolio             String?
  posicao               String?
  perna                 String?
  altura                String?
  peso                  String?
  pais                  String?
  uf                    String?
  favoriteClubId        String?   @map("clube")
  nomeFantasia          String?
  emailClube            String?
  cidade                String?
  cnpj                  String?
  inscricaoEstadual     String?
  representanteNome     String?
  representanteCpf      String?
  representanteEmail    String?
  whatsapp              String?
  registroCbf           String?
  registroFifa          String?
  responsavelNascimento String?
  responsavelGenero     String?
  responsavelInstagram  String?
  atletaNome            String?
  atletaCpf             String?
  atletaNascimento      String?
  atletaGenero          String?
  atletaEsporte         String?
  atletaModalidade      String?
  atletaObservacoes     String?
  notifNovidades        Boolean?  @default(false)
  notifJogos            Boolean?  @default(false)
  notifEventos          Boolean?  @default(false)
  notifAtletas          Boolean?  @default(false)
  termos                Boolean?  @default(false)
  lgpdWhatsappNoticias  Boolean?  @default(false)
  lgpdWhatsappConvites  Boolean?  @default(false)
  favoriteClub          Times?    @relation(fields: [favoriteClubId], references: [id])
  user                  User      @relation(fields: [userId], references: [id])
  userId                String    @unique
  comments              Comment[]
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
}

model Video {
  id            String   @id @default(cuid())
  title         String
  description   String?
  videoUrl      String
  thumbnailUrl  String?
  likesCount    Int      @default(0)
  commentsCount Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  user          User     @relation(fields: [userId], references: [id])
  userId        String
  visibilityStatus      VideoVisibilityStatus   @default(PUBLIC)
  blockReason           String?
  blockedAt             DateTime?
  blockedByAdminId      String?
  blockAppealMessage    String?
  blockAppealAt         DateTime?
  blockAppealStatus     VideoBlockAppealStatus?
  blockAppealResponse   String?
  blockAppealResolvedAt DateTime?
  blockedByAdmin        User? @relation("VideoBlockedBy", fields: [blockedByAdminId], references: [id])
}

model Follow {
  id          String   @id @default(cuid())
  follower    User     @relation("UserFollowing", fields: [followerId], references: [id], onDelete: Cascade)
  followerId  String
  following   User     @relation("UserFollowers", fields: [followingId], references: [id], onDelete: Cascade)
  followingId String
  createdAt   DateTime @default(now())

  @@unique([followerId, followingId])
}

model Message {
  id          String    @id @default(cuid())
  content     String    @db.Text
  readAt      DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  sender      User      @relation("UserSentMessages", fields: [senderId], references: [id], onDelete: Cascade)
  senderId    String
  recipient   User      @relation("UserReceivedMessages", fields: [recipientId], references: [id], onDelete: Cascade)
  recipientId String
}

model Block {
  id        String   @id @default(cuid())
  blocker   User     @relation("UserBlocking", fields: [blockerId], references: [id], onDelete: Cascade)
  blockerId String
  blocked   User     @relation("UserBlocked", fields: [blockedId], references: [id], onDelete: Cascade)
  blockedId String
  createdAt DateTime @default(now())

  @@unique([blockerId, blockedId])
}

model Confederation {
  id                    String    @id @default(cuid())
  name                  String
  slug                  String    @unique
  logoUrl               String?
  foundedAt             DateTime?
  purpose               String?
  currentPresident      String?
  officialStatement     String?   @db.Text
  officialStatementDate DateTime?
  clubs                 Club[]
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
}

model Club {
  id              String         @id @default(cuid())
  name            String         @unique
  slug            String         @unique
  confederation   Confederation? @relation(fields: [confederationId], references: [id])
  confederationId String?
  crestUrl        String?
  nickname        String?
  stadium         String?
  city            String?
  state           String?
  colors          String?
  website         String?
  foundedAt       DateTime?
  description     String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
}

model News {
  id            String     @id @default(cuid())
  title         String
  slug          String     @unique
  excerpt       String?    @db.Text
  content       String?    @db.Text
  category      String?
  coverImage    String?
  publishedAt   DateTime   @default(now())
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  likesCount    Int        @default(0)
  savesCount    Int        @default(0)
  commentsCount Int        @default(0)
  author        User?      @relation(fields: [authorId], references: [id])
  authorId      String?
  likes         NewsLike[]
  saves         NewsSave[]
}

model Game {
  id            String     @id @default(cuid())
  slug          String     @unique
  title         String?
  category      String?
  excerpt       String?    @db.Text
  content       String?    @db.Text
  coverImage    String?
  author        User?      @relation(fields: [authorId], references: [id])
  authorId      String?
  date          DateTime
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  likesCount    Int        @default(0)
  savesCount    Int        @default(0)
  commentsCount Int        @default(0)
  likes         GameLike[]
  saves         GameSave[]
}

enum CommentItemType {
  NEWS
  GAME
  VIDEO
}

model Comment {
  id              String          @id @default(cuid())
  itemType        CommentItemType
  itemId          String
  parentId        String?
  content         String          @db.Text
  authorProfileId String?
  authorName      String?
  authorAvatarUrl String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  parent          Comment?        @relation("CommentReplies", fields: [parentId], references: [id])
  replies         Comment[]       @relation("CommentReplies")
  authorProfile   Profile?        @relation(fields: [authorProfileId], references: [id])

  @@index([itemType, itemId])
  @@index([parentId])
}

model NewsLike {
  id        String   @id @default(cuid())
  news      News     @relation(fields: [newsId], references: [id], onDelete: Cascade)
  newsId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  createdAt DateTime @default(now())

  @@unique([newsId, userId])
}

model NewsSave {
  id        String   @id @default(cuid())
  news      News     @relation(fields: [newsId], references: [id], onDelete: Cascade)
  newsId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  createdAt DateTime @default(now())

  @@unique([newsId, userId])
}

model GameLike {
  id        String   @id @default(cuid())
  game      Game     @relation(fields: [gameId], references: [id], onDelete: Cascade)
  gameId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  createdAt DateTime @default(now())

  @@unique([gameId, userId])
}

model GameSave {
  id        String   @id @default(cuid())
  game      Game     @relation(fields: [gameId], references: [id], onDelete: Cascade)
  gameId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  createdAt DateTime @default(now())

  @@unique([gameId, userId])
}

model Notification {
  id        String           @id @default(cuid())
  user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  type      NotificationType
  title     String
  message   String           @db.Text
  metadata  Json?
  readAt    DateTime?
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
}

model Times {
  id         String @id @default(cuid())
  divisao    String
  clube      String
  slug       String @unique
  sigla      String
  apelido    String
  mascote    String
  fundacao   Int?
  maiorIdolo String
  cidade     String
  estado     String

  profiles Profile[]
}
